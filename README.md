[root@localhost k8s-ansible]# ansible-playbook playbook.yml
PLAY [Configurar clúster Kubernetes] *************************************************************************************************************************
TASK [Gathering Facts] *************************************************************************************************************************************** ok: [192.168.48.137] ok: [192.168.48.136]
TASK [common : Actualizar todos los paquetes] **************************************************************************************************************** ok: [192.168.48.136] ok: [192.168.48.137]
TASK [common : Instalar paquetes requeridos] ***************************************************************************************************************** ok: [192.168.48.136] ok: [192.168.48.137]
TASK [common : Deshabilitar SELinux] ************************************************************************************************************************* ok: [192.168.48.137] [WARNING]: SELinux state change will take effect next reboot ok: [192.168.48.136]
TASK [common : Deshabilitar firewall] ************************************************************************************************************************ ok: [192.168.48.136] ok: [192.168.48.137]
TASK [common : Cargar módulos del kernel necesarios] ********************************************************************************************************* ok: [192.168.48.137] => (item=br_netfilter) ok: [192.168.48.136] => (item=br_netfilter) ok: [192.168.48.137] => (item=overlay) ok: [192.168.48.136] => (item=overlay)
TASK [common : Crear archivo de módulos para persistencia] *************************************************************************************************** ok: [192.168.48.137] ok: [192.168.48.136]
TASK [common : Verificar si los módulos están cargados] ****************************************************************************************************** ok: [192.168.48.137] => (item=br_netfilter) ok: [192.168.48.136] => (item=br_netfilter) ok: [192.168.48.137] => (item=overlay) ok: [192.168.48.136] => (item=overlay)
TASK [common : Configurar sysctl para Kubernetes] ************************************************************************************************************ ok: [192.168.48.137] => (item={'key': 'net.bridge.bridge-nf-call-ip6tables', 'value': '1'}) ok: [192.168.48.136] => (item={'key': 'net.bridge.bridge-nf-call-ip6tables', 'value': '1'}) ok: [192.168.48.136] => (item={'key': 'net.bridge.bridge-nf-call-iptables', 'value': '1'}) ok: [192.168.48.137] => (item={'key': 'net.bridge.bridge-nf-call-iptables', 'value': '1'}) ok: [192.168.48.136] => (item={'key': 'net.ipv4.ip_forward', 'value': '1'}) ok: [192.168.48.137] => (item={'key': 'net.ipv4.ip_forward', 'value': '1'})
TASK [common : Desactivar swap] ****************************************************************************************************************************** ok: [192.168.48.136] ok: [192.168.48.137]
TASK [common : Comentar entrada de swap en /etc/fstab] ******************************************************************************************************* changed: [192.168.48.137] changed: [192.168.48.136]
TASK [common : Instalar containerd y herramientas] *********************************************************************************************************** ok: [192.168.48.136] ok: [192.168.48.137]
TASK [common : Configurar containerd] ************************************************************************************************************************ ok: [192.168.48.136] ok: [192.168.48.137]
TASK [common : Configurar crictl] **************************************************************************************************************************** ok: [192.168.48.136] ok: [192.168.48.137]
TASK [common : Habilitar e iniciar containerd] *************************************************************************************************************** ok: [192.168.48.136] ok: [192.168.48.137]
TASK [common : Configurar repositorio de Kubernetes para Rocky Linux 9] ************************************************************************************** ok: [192.168.48.136] ok: [192.168.48.137]
TASK [common : Instalar paquetes de Kubernetes] ************************************************************************************************************** ok: [192.168.48.136] ok: [192.168.48.137]
TASK [common : Iniciar y habilitar kubelet] ****************************************************************************************************************** ok: [192.168.48.136] ok: [192.168.48.137]
TASK [k8s-master : Verificar estado de containerd] *********************************************************************************************************** skipping: [192.168.48.137] ok: [192.168.48.136]
TASK [k8s-master : Verificar socket CRI] ********************************************************************************************************************* skipping: [192.168.48.137] ok: [192.168.48.136]
TASK [k8s-master : Inicializar clúster Kubernetes] *********************************************************************************************************** skipping: [192.168.48.137] changed: [192.168.48.136]
TASK [k8s-master : Crear directorio .kube para usuario root] ************************************************************************************************* skipping: [192.168.48.137] ok: [192.168.48.136]
TASK [k8s-master : Copiar configuración de Kubernetes] ******************************************************************************************************* skipping: [192.168.48.137] ok: [192.168.48.136]
TASK [k8s-master : Instalar red Flannel] ********************************************************************************************************************* skipping: [192.168.48.137] changed: [192.168.48.136]
TASK [k8s-master : Generar comando de unión para nodos] ****************************************************************************************************** skipping: [192.168.48.137] changed: [192.168.48.136]
TASK [k8s-master : Mostrar comando de unión] ***************************************************************************************************************** ok: [192.168.48.136] => { "msg": "Comando para unir nodos: \t--discovery-token-ca-cert-hash sha256:0c15eeda97afbdee4e6d30ada572122f75fb751dc36665850062e6b308b700dd " } skipping: [192.168.48.137]
TASK [k8s-node : Esperar a que el master esté listo] ********************************************************************************************************* skipping: [192.168.48.136] ok: [192.168.48.137]
TASK [k8s-node : Verificar existencia del comando de unión en el master] ************************************************************************************* skipping: [192.168.48.136] FAILED - RETRYING: [192.168.48.137]: Verificar existencia del comando de unión en el master (3 retries left). FAILED - RETRYING: [192.168.48.137]: Verificar existencia del comando de unión en el master (2 retries left). FAILED - RETRYING: [192.168.48.137]: Verificar existencia del comando de unión en el master (1 retries left). fatal: [192.168.48.137]: FAILED! => {"attempts": 3, "changed": false, "cmd": ["ssh", "-o", "ConnectTimeout=15", "-o", "BatchMode=yes", "root@192.168.48.136", "test -f /root/join-command.sh && echo 'EXISTS' || echo 'MISSING'"], "delta": "0:00:00.075274", "end": "2025-06-07 09:59:13.319345", "msg": "non-zero return code", "rc": 255, "start": "2025-06-07 09:59:13.244071", "stderr": "root@192.168.48.136: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).", "stderr_lines": ["root@192.168.48.136: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password)."], "stdout": "", "stdout_lines": []} ...ignoring
TASK [k8s-node : Obtener comando de unión desde el master] *************************************************************************************************** skipping: [192.168.48.136] FAILED - RETRYING: [192.168.48.137]: Obtener comando de unión desde el master (5 retries left). FAILED - RETRYING: [192.168.48.137]: Obtener comando de unión desde el master (4 retries left). FAILED - RETRYING: [192.168.48.137]: Obtener comando de unión desde el master (3 retries left). FAILED - RETRYING: [192.168.48.137]: Obtener comando de unión desde el master (2 retries left). FAILED - RETRYING: [192.168.48.137]: Obtener comando de unión desde el master (1 retries left). fatal: [192.168.48.137]: FAILED! => {"attempts": 5, "changed": false, "cmd": ["ssh", "-o", "ConnectTimeout=15", "-o", "BatchMode=yes", "root@192.168.48.136", "cat /root/join-command.sh 2>/dev/null"], "delta": "0:00:00.076113", "end": "2025-06-07 10:00:06.288933", "msg": "non-zero return code", "rc": 255, "start": "2025-06-07 10:00:06.212820", "stderr": "root@192.168.48.136: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).", "stderr_lines": ["root@192.168.48.136: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password)."], "stdout": "", "stdout_lines": []} ...ignoring
TASK [k8s-node : Mostrar comando de unión para depuración] *************************************************************************************************** skipping: [192.168.48.136] skipping: [192.168.48.137]
TASK [k8s-node : Unir nodo al clúster] *********************************************************************************************************************** skipping: [192.168.48.136] skipping: [192.168.48.137]
TASK [Instalar Podman y dependencias] ************************************************************************************************************************ ok: [192.168.48.137] ok: [192.168.48.136]
TASK [Crear configuración para Podman como runtime de Kubernetes] ******************************************************************************************** changed: [192.168.48.136] changed: [192.168.48.137]
TASK [Iniciar y habilitar containerd] ************************************************************************************************************************ ok: [192.168.48.136] ok: [192.168.48.137]
PLAY RECAP *************************************************************************************************************************************************** 192.168.48.136 : ok=29 changed=5 unreachable=0 failed=0 skipped=5 rescued=0 ignored=0 192.168.48.137 : ok=24 changed=2 unreachable=0 failed=0 skipped=10 rescued=0 ignored=2
[root@localhost k8s-ansible]#
